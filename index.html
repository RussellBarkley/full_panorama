<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Deep Zoom Viewer — Stitched Image</title>

  <!-- Local OpenSeadragon + scalebar plugin -->
  <script src="openseadragon/openseadragon.min.js"></script>
  <script src="openseadragon/openseadragon-scalebar.js"></script>

  <style>
    html, body { height: 100%; margin: 0; background: #111; }
    #osd { width: 100%; height: 100%; }
    .hint { position: absolute; left: 12px; top: 10px; color: #ddd; font: 12px/1.2 sans-serif; opacity: .8; }
  </style>
</head>
<body>
  <div id="osd"></div>
  <div class="hint">Mouse: drag to pan • wheel/ctrl+wheel to zoom • mini-map at bottom-right</div>

  <script>
    // --- Quick config ---
    // Default DZI produced by your stitching script:
    const DEFAULT_DZI = 'stitched_full.dzi'; // e.g., 'dzi/stitched_full.dzi' if you move it

    // Let URL param override: index.html?dzi=quarters/stitched_full.dzi
    const params = new URLSearchParams(location.search);
    const dziPath = params.get('dzi') || DEFAULT_DZI;

    // Scale: 8.0453 pixels per micrometer (µm) → pixels per meter for the scalebar plugin
    const PX_PER_MICRON = 8.0453;
    const PX_PER_METER  = PX_PER_MICRON * 1e6;

    const viewer = OpenSeadragon({
      id: 'osd',
      prefixUrl: 'openseadragon/images/',   // path to OSD button icons
      showNavigator: true,
      navigatorPosition: 'BOTTOM_RIGHT',
      animationTime: 0.9,
      blendTime: 0.2,
      springStiffness: 6.5,
      maxZoomPixelRatio: 2.5,
      visibilityRatio: 1.0,
      minZoomLevel: 0,
      gestureSettingsMouse: { clickToZoom: true, dblClickToZoom: true },
      tileSources: dziPath                      // ← load the .dzi directly
    });

    // Add a scalebar (MAP mode uses pixelsPerMeter, so zoom level doesn't matter)
    viewer.addHandler('open', () => {
      viewer.scalebar({
        type: OpenSeadragon.ScalebarType.MAP,
        pixelsPerMeter: PX_PER_METER,                 // 8.0453 px/µm → 8,045,300 px/m
        location: OpenSeadragon.ScalebarLocation.BOTTOM_LEFT,
        xOffset: 12,
        yOffset: 12,
        barThickness: 4,
        color: 'white',
        fontColor: 'white',
        backgroundColor: 'rgba(0,0,0,0.5)',
        stayInsideImage: true
      });
    });
  </script>
</body>
</html>
